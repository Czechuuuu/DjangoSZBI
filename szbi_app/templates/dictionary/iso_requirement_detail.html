{% extends 'base.html' %}

{% block title %}{{ iso_req.iso_id }} - Wymaganie ISO - SZBI{% endblock %}

{% block content %}
<h2>Wymaganie ISO: {{ iso_req.iso_id }}</h2>

<p>
    <a href="{% url 'dictionary:iso_tree' %}">‚Üê Drzewo ISO</a>
    | <a href="{% url 'dictionary:iso_requirement_list' %}">Lista wymaga≈Ñ</a>
    | <a href="{% url 'dictionary:iso_requirement_update' iso_req.pk %}">Edytuj</a>
    | <a href="{% url 'dictionary:iso_requirement_delete' iso_req.pk %}">Usu≈Ñ</a>
</p>

<table border="1" cellpadding="12" cellspacing="0">
    <tr>
        <th>ID wymagania</th>
        <td><strong>{{ iso_req.iso_id }}</strong></td>
    </tr>
    <tr>
        <th>Nazwa</th>
        <td>{{ iso_req.name }}</td>
    </tr>
    {% if iso_req.objective %}
    <tr>
        <th>Domena</th>
        <td>{{ iso_req.objective.domain }}</td>
    </tr>
    <tr>
        <th>Cel wymaga≈Ñ</th>
        <td>
            {{ iso_req.objective }}
            {% if iso_req.objective.objective_text %}
            <br><em style="color: #555;">Cel: {{ iso_req.objective.objective_text }}</em>
            {% endif %}
        </td>
    </tr>
    {% endif %}
    {% if iso_req.description %}
    <tr>
        <th>Opis wymagania</th>
        <td>{{ iso_req.description|linebreaks }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>Czy stosujemy?</th>
        <td>
            {% if iso_req.is_applied == 'yes' %}
                <span style="color: green;">‚úì Tak</span>
            {% elif iso_req.is_applied == 'no' %}
                <span style="color: red;">‚úó Nie</span>
            {% elif iso_req.is_applied == 'partial' %}
                <span style="color: orange;">‚óê Czƒô≈õciowo</span>
            {% else %}
                <span style="color: gray;">‚Äî Nie dotyczy</span>
            {% endif %}
        </td>
    </tr>
    <tr>
        <th>Spos√≥b realizacji</th>
        <td>
            {% if iso_req.implementation_method %}
                {{ iso_req.implementation_method|linebreaks }}
            {% else %}
                <em>Nie okre≈õlono</em>
            {% endif %}
        </td>
    </tr>
    {% if iso_req.notes %}
    <tr>
        <th>Uwagi</th>
        <td>{{ iso_req.notes|linebreaks }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>Data utworzenia</th>
        <td>
            {{ iso_req.created_at|date:"Y-m-d H:i" }}
            {% if iso_req.created_by %}(przez {{ iso_req.created_by.username }}){% endif %}
        </td>
    </tr>
    <tr>
        <th>Ostatnia modyfikacja</th>
        <td>
            {{ iso_req.updated_at|date:"Y-m-d H:i" }}
            {% if iso_req.updated_by %}(przez {{ iso_req.updated_by.username }}){% endif %}
        </td>
    </tr>
</table>

<!-- Za≈ÇƒÖczniki (pliki) -->
<h3>üìé Pliki / za≈ÇƒÖczniki</h3>

{% if attachments %}
<table border="1" cellpadding="8" cellspacing="0">
    <thead>
        <tr>
            <th>Tytu≈Ç</th>
            <th>Plik</th>
            <th>Dodano</th>
            <th>Przez</th>
            <th>Akcje</th>
        </tr>
    </thead>
    <tbody>
        {% for att in attachments %}
        <tr>
            <td>{{ att.title }}</td>
            <td>{{ att.get_filename }}</td>
            <td>{{ att.uploaded_at|date:"Y-m-d H:i" }}</td>
            <td>{{ att.uploaded_by.username|default:"-" }}</td>
            <td>
                <a href="{% url 'dictionary:attachment_download' att.pk %}">Pobierz</a>
                | <a href="{% url 'dictionary:attachment_delete' att.pk %}">Usu≈Ñ</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p><em>Brak za≈ÇƒÖcznik√≥w.</em></p>
{% endif %}

<p>
    <a href="{% url 'dictionary:attachment_add' iso_req.pk %}">+ Dodaj plik</a>
</p>

<!-- PowiƒÖzane dokumenty -->
<h3>üìÑ PowiƒÖzane dokumenty</h3>

{% if document_mappings %}
<table border="1" cellpadding="8" cellspacing="0">
    <thead>
        <tr>
            <th>Dokument</th>
            <th>Typ powiƒÖzania</th>
            <th>Sekcja</th>
            <th>Status dokumentu</th>
        </tr>
    </thead>
    <tbody>
        {% for mapping in document_mappings %}
        <tr>
            <td>
                <a href="{% url 'documents:detail' mapping.document.pk %}">
                    <strong>{{ mapping.document.title }}</strong>
                </a>
                {% if mapping.notes %}
                <br><small><em>{{ mapping.notes }}</em></small>
                {% endif %}
            </td>
            <td>{{ mapping.get_mapping_type_display }}</td>
            <td>{{ mapping.section_reference|default:"-" }}</td>
            <td>{{ mapping.document.get_status_display }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p><em>To wymaganie nie jest jeszcze powiƒÖzane z ≈ºadnymi dokumentami.</em></p>
<p>
    <a href="{% url 'documents:list' %}">Przejd≈∫ do listy dokument√≥w</a>, aby dodaƒá powiƒÖzania.
</p>
{% endif %}

{% endblock %}
