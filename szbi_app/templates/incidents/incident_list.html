{% extends "base.html" %}

{% block title %}Wszystkie incydenty - SZBI{% endblock %}

{% block content %}
<h2>Wszystkie incydenty</h2>

<p>
    <a href="{% url 'incidents:report' %}">+ Zg≈Ço≈õ nowy incydent</a> |
    <a href="{% url 'incidents:my_list' %}">Moje zg≈Çoszenia</a>
</p>

<!-- Filtry -->
<form method="get" style="margin-bottom: 20px;">
    <fieldset>
        <legend>Filtry</legend>
        <label>Status:
            <select name="status">
                <option value="">-- Wszystkie --</option>
                {% for value, label in status_choices %}
                <option value="{{ value }}" {% if current_status == value %}selected{% endif %}>
                    {{ label }}
                </option>
                {% endfor %}
            </select>
        </label>
        
        <label>Klasyfikacja:
            <select name="severity">
                <option value="">-- Wszystkie --</option>
                {% for value, label in severity_choices %}
                <option value="{{ value }}" {% if current_severity == value %}selected{% endif %}>
                    {{ label }}
                </option>
                {% endfor %}
            </select>
        </label>
        
        <label>Kategoria:
            <select name="category">
                <option value="">-- Wszystkie --</option>
                {% for value, label in category_choices %}
                <option value="{{ value }}" {% if current_category == value %}selected{% endif %}>
                    {{ label }}
                </option>
                {% endfor %}
            </select>
        </label>
        
        <label>Szukaj:
            <input type="text" name="q" value="{{ current_search }}" placeholder="Temat, opis...">
        </label>
        
        <button type="submit">Filtruj</button>
        <a href="{% url 'incidents:list' %}">Wyczy≈õƒá</a>
    </fieldset>
</form>

{% if incidents %}
<table border="1" cellspacing="0" cellpadding="5" style="width: 100%;">
    <thead>
        <tr>
            <th>#</th>
            <th>Temat</th>
            <th>Status</th>
            <th>Klasyfikacja</th>
            <th>Kategoria</th>
            <th>Zg≈ÇaszajƒÖcy</th>
            <th>Przypisany do</th>
            <th>Data zg≈Çoszenia</th>
            <th>Akcje</th>
        </tr>
    </thead>
    <tbody>
        {% for incident in incidents %}
        <tr>
            <td>{{ incident.pk }}</td>
            <td>
                <a href="{% url 'incidents:detail' incident.pk %}">{{ incident.title }}</a>
                {% if incident.is_serious %}<br><span style="color: red;">‚ö† Powa≈ºny</span>{% endif %}
                {% if incident.involves_personal_data %}<span style="color: orange;">üîí Dane osobowe</span>{% endif %}
            </td>
            <td>{{ incident.get_status_display }}</td>
            <td>{{ incident.get_severity_display|default:"-" }}</td>
            <td>{{ incident.get_category_display|default:"-" }}</td>
            <td>{{ incident.reporter.username }}</td>
            <td>
                {% if incident.assigned_to %}
                    {{ incident.assigned_to.first_name }} {{ incident.assigned_to.last_name }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ incident.created_at|date:"Y-m-d H:i" }}</td>
            <td>
                <a href="{% url 'incidents:detail' incident.pk %}">Szczeg√≥≈Çy</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>Brak incydent√≥w do wy≈õwietlenia.</p>
{% endif %}

{% endblock %}
